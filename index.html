<!-- Подключаем скрипты в head или перед основным кодом -->
<script src="baremux/index.js"></script>
<script src="uv/uv.bundle.js"></script>
<script src="uv/uv.config.js"></script>

<!-- Твой основной скрипт управления -->
<script>
  async function setupWisp() {
    // 1. Инициализируем соединение с воркером bare-mux
    const connection = new BareMux.BareMuxConnection("/baremux/worker.js");

    // 2. УКАЖИ ЗДЕСЬ СВОЙ WISP СЕРВЕР
    const wispUrl = "wss://твой-висп-сервер.com/wisp/"; 

    // 3. Устанавливаем транспорт Epoxy (он работает с Wisp)
    if (!(await connection.getTransport())) {
        await connection.setTransport("/epoxy/index.mjs", [{ wisp: wispUrl }]);
    }
    console.log("Wisp подключен!");
  }

  setupWisp();

  // Функция для запуска прокси (при нажатии на кнопку)
  function launchProxy(url) {
    setupWisp().then(() => {
      const encodedUrl = __uv$config.prefix + __uv$config.encodeUrl(url);
      
      // Регистрация SW и переход
      navigator.serviceWorker.register('./sw.js', {
        scope: __uv$config.prefix
      }).then(() => {
        location.href = encodedUrl;
      });
    });
  }
</script>
